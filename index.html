<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>설날 운세 뽑기</title>

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,'Noto Sans KR',sans-serif;
  background:#f6e7cc;
}

.top-bg,.bottom-bg{
  width:100%;
  display:block;
}

.float{
  animation:float 3s ease-in-out infinite;
}

@keyframes float{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-10px)}
}

.card-wrap{
  display:flex;
  justify-content:center;
  padding:60px 20px;
}

.card{
  width:100%;
  max-width:700px;
  background:white;
  padding:60px 40px;
  border-radius:30px;
  text-align:center;
  box-shadow:0 20px 50px rgba(0,0,0,0.15);
}

button{
  margin-top:40px;
  width:100%;
  padding:24px;
  border:none;
  border-radius:20px;
  background:linear-gradient(135deg,#ff4d4d,#ff9f1a);
  color:white;
  font-size:22px;
  font-weight:700;
  cursor:pointer;
}

button:disabled{
  background:#ccc;
  cursor:not-allowed;
}

.result{
  margin-top:30px;
  font-size:30px;
  font-weight:900;
}

.sub{
  margin-top:12px;
  font-size:20px;
}
</style>
</head>

<body>

<img src="top.png" class="top-bg float">

<div class="card-wrap">
<div class="card">

<h1>설날 운세 뽑기</h1>
<p>선착순 이벤트 / 기기당 1회</p>

<button id="drawBtn">운세 뽑기</button>

<div id="result" class="result"></div>
<div id="sub" class="sub"></div>

</div>
</div>

<img src="bottom.png" class="bottom-bg float">

<script>
const STORAGE_KEY="fortune_event_once_2026";

const btn=document.getElementById("drawBtn");
const result=document.getElementById("result");
const sub=document.getElementById("sub");

/* 페이지 들어오면 참여 여부 체크 */
if(localStorage.getItem(STORAGE_KEY)){
  btn.disabled=true;
  btn.textContent="이미 참여함";
  result.textContent="이미 참여했습니다!";
  sub.textContent="기기당 1회 이벤트입니다.";
}

/* 버튼 클릭 */
btn.addEventListener("click",async()=>{

  // 기기당 1회 체크
  if(localStorage.getItem(STORAGE_KEY)){
    alert("이미 참여했습니다!");
    return;
  }

  btn.disabled=true;
  btn.textContent="뽑는 중...";

  try{
    // ⭐ 서버 호출 (네 draw.js)
    const res=await fetch("/api/draw",{method:"GET"});

    if(!res.ok) throw new Error("server error");

    const data=await res.json();

    result.textContent=data.title || "결과 없음";
    sub.textContent=data.desc || "";

    // 성공했을 때만 1회 제한 저장
    localStorage.setItem(STORAGE_KEY,"true");

  }catch(err){
    // 서버 문제면 다시 누를 수 있게
    result.textContent="서버 오류";
    sub.textContent="잠시 후 다시 시도하세요";

    btn.disabled=false;
    btn.textContent="운세 뽑기";
  }

});
</script>

</body>
</html>
